#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏"
echo "========================================================="

# –¢–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã
echo ""
echo "üìä –¢–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã:"
echo "   –õ–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤: $(ulimit -n)"
echo "   –õ–∏–º–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: $(ulimit -u)"

# –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç—ã
echo ""
echo "‚öôÔ∏è –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤..."

# macOS —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ
if [[ "$OSTYPE" == "darwin"* ]]; then
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π –ª–∏–º–∏—Ç
    current_limit=$(ulimit -n)
    
    if [ "$current_limit" -lt 4096 ]; then
        # –ü—Ä–æ–±—É–µ–º —É–≤–µ–ª–∏—á–∏—Ç—å
        ulimit -n 4096 2>/dev/null
        
        if [ $? -eq 0 ]; then
            echo "‚úÖ –õ–∏–º–∏—Ç —Ñ–∞–π–ª–æ–≤ —É–≤–µ–ª–∏—á–µ–Ω –¥–æ: $(ulimit -n)"
        else
            echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç —Ñ–∞–π–ª–æ–≤"
            echo "   –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:"
            echo "   sudo launchctl limit maxfiles 4096 4096"
            echo ""
            echo "   –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ /etc/sysctl.conf:"
            echo "   kern.maxfiles=65536"
            echo "   kern.maxfilesperproc=4096"
        fi
    else
        echo "‚úÖ –õ–∏–º–∏—Ç —Ñ–∞–π–ª–æ–≤ —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π: $current_limit"
    fi
else
    # Linux
    ulimit -n 4096 2>/dev/null
    if [ $? -eq 0 ]; then
        echo "‚úÖ –õ–∏–º–∏—Ç —Ñ–∞–π–ª–æ–≤ —É–≤–µ–ª–∏—á–µ–Ω –¥–æ: $(ulimit -n)"
    else
        echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç"
        echo "   –î–æ–±–∞–≤—å—Ç–µ –≤ /etc/security/limits.conf:"
        echo "   * soft nofile 4096"
        echo "   * hard nofile 8192"
    fi
fi

echo ""
echo "üìä –ù–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã:"
echo "   –õ–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤: $(ulimit -n)"
echo "   –õ–∏–º–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: $(ulimit -u)"

echo ""
echo "üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏:"
echo "   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ –±–æ–ª–µ–µ 10-15 –ø–æ—Ç–æ–∫–æ–≤ –µ—Å–ª–∏ –ª–∏–º–∏—Ç < 1024"
echo "   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 15-20 –ø–æ—Ç–æ–∫–æ–≤ –µ—Å–ª–∏ –ª–∏–º–∏—Ç 1024-2048"
echo "   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 20-25 –ø–æ—Ç–æ–∫–æ–≤ –µ—Å–ª–∏ –ª–∏–º–∏—Ç > 2048"
echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏!"