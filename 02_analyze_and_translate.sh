#!/bin/bash

# –£–º–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
echo "üìö –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–´–ô –ü–ï–†–ï–í–û–î–ß–ò–ö –° –ê–í–¢–û–ö–û–ù–¢–ï–ö–°–¢–û–ú"
echo "==============================================="
echo ""

# –®–∞–≥ 1: –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –∫–Ω–∏–≥–∏
echo "üìñ –®–∞–≥ 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞..."
if [ -f "extracted_content.json" ]; then
    echo "   ‚úì –ö–Ω–∏–≥–∞ —É–∂–µ –∏–∑–≤–ª–µ—á–µ–Ω–∞"
else
    python3 01_extract_book.py
fi

# –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
echo ""
echo "üîç –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–Ω–∏–≥–∏..."
python3 analyze_context.py

if [ $? -eq 0 ]; then
    echo "   ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    echo ""
    echo "üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:"
    python3 -c "
import yaml
with open('translation_context.yaml', 'r') as f:
    ctx = yaml.safe_load(f)
    print(f\"   –¢–∏–ø: {ctx.get('text_type', '–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω')}\")
    print(f\"   –û–±–ª–∞—Å—Ç—å: {ctx.get('domain', '–æ–±—â–∞—è')}\")
    print(f\"   –°—Ç–∏–ª—å: {ctx.get('style', {}).get('formality', '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π')}\")
    print(f\"   –ê—É–¥–∏—Ç–æ—Ä–∏—è: {ctx.get('style', {}).get('audience', '–æ–±—â–∞—è')}\")
"
else
    echo "   ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç"
fi

# –®–∞–≥ 3: –ü–µ—Ä–µ–≤–æ–¥ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
echo ""
echo "üåê –®–∞–≥ 3: –ü–µ—Ä–µ–≤–æ–¥ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞..."
python3 03_translate_parallel.py

echo ""
echo "‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω —Å —É—á–µ—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞!"